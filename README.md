# Timeshift Backup and Google Drive Sync

This repository contains a Bash script for creating backups of your Timeshift snapshots and syncing them to Google Drive. It also includes a `.gitignore` file to keep certain files untracked by Git.

### Timeshift Setup

1. First, you need to install Timeshift. If it's not already installed, you can do so by running the following command in the terminal:
    ```bash
    sudo apt install timeshift
    ```

2. Once installed, open Timeshift from your applications menu.

3. In the Timeshift application, choose RSYNC as the snapshot type and click 'Next'.

4. Select the disk where you want your snapshots to be saved and click 'Next'.

5. Configure how often you want Timeshift to take snapshots. A typical setup might be to take monthly snapshots and keep them for a year. Adjust according to your needs and click 'Next'.

6. If you like, you can set up Timeshift to take snapshots automatically whenever your system is booted. Adjust according to your needs and click 'Next'.

7. Finally, review your settings and click 'Finish'.

## `timeshift_to_gdrive.sh`

This script automates the backup process of Timeshift snapshots to a local directory as only root should have access to snapshot.

## Script: gdrive_move.sh

This bash script moves the `.tar.gz` backup files from the local `linuxbckup` directory to your Google Drive directory. These backup files are generated by another script `timeshift_to_gdrive.sh`.

### Script Breakdown

The `timeshift_to_gdrive.sh` script performs the following operations:

1. **Set script directory**: The script identifies its own directory location and assigns it to the variable `dir`.

2. **Set backup directory**: The `BACKUP_DIR` is then set to be a `linuxbckup` directory inside the script's own directory.

3. **Read Google Drive sync directory**: The Google Drive sync directory location is read from a text file `gdrivesettings.txt` present in the script's directory.

4. **Move the backup files**: The script moves the `latestbckp.tar.gz` and `oldestbckp.tar.gz` files from the `linuxbckup` directory to the Google Drive sync directory. 

To schedule the `timeshift_to_gdrive.sh` script to run daily at a specific time, follow the steps below. Let's say you want it to run at 4 AM daily.

5. Open a terminal.

6. Type `crontab -e` to edit the cron table.

7. Add the following line at the end of the file:

```0 2 * * * /path/to/timeshift_to_gdrive.sh```

### Setting up a cron job for movefile.sh

To schedule this script to run daily at 5 AM using cron, you would:

1. Open a terminal.

2. Type `crontab -e` to edit the cron table.

3. Add the following line at the end of the file:

```0 5 * * * /path/to/movefile.sh```

Change the permissions of the scripts to make them executable.


```chmod +x timeshift_to_gdrive.sh```

```chmod +x movefile.sh```

### Features
- Creates `.tar.gz` archive of the latest and oldest Timeshift snapshots.
- Assigns these archives a fixed name (`latestbckp.tar.gz` and `oldestbckp.tar.gz` respectively) for easy identification.
- Adds these files to a specified Google Drive folder for synchronization.

### How it works

1. The script reads the first two lines from `gdrivesettings.txt` to get the path to your Google Drive folder and the username for whom to set file permissions.
2. It then finds the latest and oldest snapshots from your Timeshift directory.
3. For both the latest and oldest snapshots, it:
   - Creates a `.tar.gz` archive.
   - Stores the archives in a folder named `linuxbckup`.
4. It ensures that a group named `bckupgrp` exists and that your user is a member of it.
5. It then sets the group ownership of the `linuxbckup` folder to `bckupgrp` and sets its permissions to `770`.

## `.gitignore`

This is a text file that tells Git which files (or patterns of files) to ignore.

In this project, the `.gitignore` file tells Git to ignore:

- Any `.txt` file. This is to avoid pushing potentially sensitive data (like the contents of `gdrivesettings.txt`) to your repository.
- Any `.tar.gz` file. This is to avoid pushing large binary files (like your backups) to your repository, which is not an efficient use of Git and can make cloning your repository very slow.

## Instructions

To use this script:

1. Clone the repository.
2. Add the path to your Google Drive folder and your username to `gdrivesettings.txt` (one per line).
3. Run `timeshift_to_gdrive.sh` as root or with sudo.

**Note:** Be sure to set up your Google Drive to sync the folder specified in `gdrivesettings.txt`.


